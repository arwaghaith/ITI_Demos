/********************************************************************************************************/
/************************************************Includes************************************************/
/********************************************************************************************************/


#include"SCHED.h"


/********************************************************************************************************/
/************************************************Defines*************************************************/
/********************************************************************************************************/




#define SCHED_u32TICK_TIME  1

/********************************************************************************************************/
/************************************************Types***************************************************/
/********************************************************************************************************/



/********************************************************************************************************/
/************************************************Variables***********************************************/
/********************************************************************************************************/
extern runnable_t RunnableList[ _NUM_OF_Runnables ];

 volatile u32 PendingTicks;

/********************************************************************************************************/
/*****************************************Static Functions Prototype*************************************/
/********************************************************************************************************/

 void  fireCB (void);
static void Sched(void);

/********************************************************************************************************/
/*********************************************APIs Implementation****************************************/
/********************************************************************************************************/
void Sched_Init(void)
{

Systick_vidInit();
Systick_SetTicTime_ms(SCHED_u32TICK_TIME);
Systick_RegisterCbf(fireCB);  

}

void Sched_Start (void)
{

Systick_vidStart();
while (1)
{ 
	if ( PendingTicks)
	{
		
	PendingTicks--;
	Sched();
	}
	else {
		//test
	}
}

}


static void Sched(void)
{
	static u32 SCHED_u32TimeSTAMP_ms=0; 
	u32 SCHED_u32Idx ;
 
	for( SCHED_u32Idx = 0 ; SCHED_u32Idx <  _NUM_OF_Runnables ; SCHED_u32Idx++ )
	{
		
        if((RunnableList[SCHED_u32Idx].CallBack != NULL_PTR)&& (SCHED_u32TimeSTAMP_ms%RunnableList[SCHED_u32Idx].periodicity ==0))
		{
			RunnableList[SCHED_u32Idx].CallBack();
		}
	}
	SCHED_u32TimeSTAMP_ms += SCHED_u32TICK_TIME;
}

 void  fireCB (void)
{
    PendingTicks++;
}